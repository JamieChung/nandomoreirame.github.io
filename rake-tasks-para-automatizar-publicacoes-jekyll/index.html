<!DOCTYPE html><html class="no-js" lang="pt-br" itemscope itemtype="http://schema.org/BlogPosting"><head><meta charset="utf-8"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="google-site-verification" content="zS1dSn20XtA4FJYEOQLXqI0boxZdMnJ2g3beje-cl20"><title> Usando Rake tasks para automatizar publicações Jekyll | Fernando Moreira</title><meta name="description" content=" Rake é um Ruby Make, um utilitário usado para executar uma lista de tarefas em Ruby. São bastante utilizadas por desenvolvedores Ruby on Rails para automatiz... "><meta name="keywords" content="jekyll, rake, ruby"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="theme-color" content="#005344"><meta itemprop="image" content=" http://nandomoreira.me/assets/images/banner.jpg "> <meta property="fb:admins" content="100003797913346"><meta property="fb:app_id" content="585852118228520"><meta property="og:type" content="article"><meta property="article:author" content="Fernando Moreira"><meta property="article:section" content="jekyll"><meta property="article:tag" content="jekyll, rake, ruby"><meta property="article:published_time" content="2015-08-01 15:28:15 +0000"><meta property="og:url" content="http://nandomoreira.me/rake-tasks-para-automatizar-publicacoes-jekyll"><meta property="og:title" content=" Usando Rake tasks para automatizar publicações Jekyll | Fernando Moreira "><meta property="og:image" content=" http://nandomoreira.me/assets/images/banner.jpg "><meta property="og:description" content=" Rake é um Ruby Make, um utilitário usado para executar uma lista de tarefas em Ruby. São bastante utilizadas por desenvolvedores Ruby on Rails para automatiz... "><meta property="og:site_name" content="Fernando Moreira"><meta property="og:locale" content="pt_BR"> <meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@nandomoreirame"><meta name="twitter:title" content=" Usando Rake tasks para automatizar publicações Jekyll | Fernando Moreira "><meta name="twitter:description" content=" Rake é um Ruby Make, um utilitário usado para executar uma lista de tarefas em Ruby. São bastante utilizadas por desenvolvedores Ruby on Rails para automatiz... "><meta name="twitter:image:src" content=" http://nandomoreira.me/assets/images/banner.jpg "> <meta itemprop="name" content=" Usando Rake tasks para automatizar publicações Jekyll | Fernando Moreira "><meta itemprop="description" content=" Rake é um Ruby Make, um utilitário usado para executar uma lista de tarefas em Ruby. São bastante utilizadas por desenvolvedores Ruby on Rails para automatiz... "><meta itemprop="image" content=" http://nandomoreira.me/assets/images/banner.jpg "><link rel="apple-touch-icon" sizes="57x57" href="/assets/images/ico/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/images/ico/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/images/ico/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/images/ico/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/images/ico/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/images/ico/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/images/ico/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/images/ico/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/ico/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/images/ico/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/ico/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/ico/favicon-16x16.png"><link rel="shortcut icon" href="/assets/images/ico/favicon-16x16.png"><link rel="manifest" href="/assets/images/ico/manifest.jso"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/images/ico/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/main-d8a7a95d8c85ad1b7d681adc893d7aad.css"> <script src="/assets/modernizr-custom-f107b7598612dd5dee41b91ec615408f.js" data-cfasync="false"></script><link rel="canonical" href="http://nandomoreira.me/rake-tasks-para-automatizar-publicacoes-jekyll"><link rel="alternate" type="application/rss+xml" title="Fernando Moreira" href="http://nandomoreira.me/feed.xml"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Website", "publisher": "nandomoreira.me", "url": "http://nandomoreira.me/", "description": "Desenvolvedor Front-end, Design Responsivo, HTML5, CSS3 e JavaScript" } </script> <script type="text/javascript"> var disqus_shortname = 'fernandomoreira'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-52446115-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script><body class="post-template single"><header class="header"> <a href="/"> <img src="/assets/images/author.jpg" alt="author thumb" class="dot author-thumb"> </a><h1 itemscope itemtype="http://schema.org/Person">Olá meu nome é <strong itemprop="name">Fernando Moreira</strong> eu sou <em itemprop="jobTitle">Front-end</em> e gosto muito de café!</h1><nav class="nav"><ul class="navbar"><li><a href="/blog" class="subnav-trigger"><span>Artigos</span></a><li><a href="/about">Sobre</a><li class="search"> <a href="#!" data-modal-search="modalSearch"><i class="fa fa-search"></i> Busca</a></ul></nav></header><main class="wrapper" itemprop="mainContentOfPage"><article role="article" class="post" itemprop="articleBody"><div class="container"><header class="post-header"><h1 class="post-title">Usando Rake tasks para automatizar publicações Jekyll</h1><div class="post-meta"> <time datetime="2015-08-01T15:28:15+00:00" itemprop="datePublished"><meta itemprop="datePublished" content="2015-08-01T15:28:15+00:00"> <i class="fa fa-calendar-o"></i> 1/8/2015 </time> <span> | <i class="fa fa-comments"></i> <a href="/rake-tasks-para-automatizar-publicacoes-jekyll#disqus_thread" data-disqus-identifier="/usando-rake-tasks-para-automatizar-publicaes-jekyll">Deixe um comentário</a> </span> <span> | <i class="fa fa-folder-open-o"></i> <a href="/categoria/jekyll/">Jekyll</a> </span></div></header><div class="post-content"><h3 id="mas-afinal-o-que--rake">Mas afinal, o que é Rake?</h3><p>Rake é um Ruby Make, um utilitário usado para executar uma lista de tarefas em Ruby. São bastante utilizadas por desenvolvedores Ruby on Rails para automatizar tarefas como manipulação de assets, migração de banco de dados, limpar cache e muito mais..<p>Hoje vamos entender como podemos criar e usar algumas rake tasks em nosso projeto Jekyll, com elas podemos criar automaticamente os arquivos <code>.md</code>de nossos posts, criar páginas, categorias e outras tarefas customizadas para o Jekyll, é bem bacana e fácil de fazer, vem comigo.<h3 id="hello-world-com-rake">“Hello World” com Rake</h3><p>A primeira coisa que você precisa fazer é instalar o Ruby em sua máquina, como estamos falando de <em>“Automatizar publicações Jekyll”</em> então vou pressupor que você já tenha o Ruby e a Gem do Jekyll já instalada.<p>Baixe e instale a gem rake com o seguinte comando:<div class="highlight"><pre><code class="language-bash" data-lang="bash">gem install rake</code></pre></div><p>Após a instalação você deve criar um arquivo chamado <code>Rakefile</code> onde serão escritas as suas tarefas.<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:hello</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">&quot;Hello World&quot;</span>
<span class="k">end</span></code></pre></div><p>Se você rodar no seu terminal o comando <code>rake hello</code> aparecerá na tela, bem bonitão, o nosso famoso “Hello World”.<p><a href="/assets/images/posts/2015/08/rake-hello-world.png" class="swipebox" rel="gallery" title="Usando Rake tasks para automatizar publicações Jekyll"> <img src="/assets/images/posts/2015/08/rake-hello-world.png" alt="Usando Rake tasks para automatizar publicações Jekyll" /> </a><p>Pronto, agora você aprendeu a criar uma Rake task, se você for criativo e souber o básico de Ruby você fará coisas incríveis com elas.<h3 id="rake-e-o-jekyll">Rake e o Jekyll</h3><p>Agora vamos implementar nossas tasks em nosso projeto Jekyll, e quero fazer um exercício com você, quero que pense o seguinte:<blockquote><p>O que podemos fazer para facilitar uma publicação Jekyll?</blockquote><p>Isso mesmo que você pensou, <code>criar o arquivo do post dentro do diretório _posts/</code>, muito bem pensado pequeno gafanhoto!<p>Vamos começar criando variáveis globais para armazenar coisas que serão utilizadas dentro das nossas tasks. Logo no início do arquivo Rakefile adicione as seguintes linhas:<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">SOURCE</span>    <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<span class="no">POSTS_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">SOURCE</span><span class="p">,</span> <span class="s2">&quot;_posts&quot;</span><span class="p">)</span>
<span class="no">POST_EXT</span>  <span class="o">=</span> <span class="s2">&quot;.md&quot;</span></code></pre></div><p>Nós temos em mãos o diretório onde serão armazenados nossos artigos e a extenção que será utilizada em cada arquivo.<p>Agora vamos criar uma task chamada <code>post</code>:<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="c1"># codigos ruby aqui</span>
<span class="k">end</span></code></pre></div><p>Se você rodar <code>rake post</code> do seu terminal não acontecerá nada pois nossa task está vazia.<h3 id="passando-parmetros-para-rake-task">Passando parâmetros para Rake task</h3><p>Para criar nosso artigo via rake task nós precisaremos passar alguns parâmetros necessários, como por exemplo, o Título do post.<p>Para capturar esse parâmentro passado no terminal nós usaremos uma variável global do Ruby chamada <code>ENV[]</code>, com ela pegaremos todo e qualquer parâmetro passado para a task.<p>Vamos pegar nosso Título e armazenar em uma variável chamada <code>title</code>:<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;Novo post&quot;</span>
  <span class="nb">puts</span> <span class="n">title</span>
<span class="k">end</span></code></pre></div><p>Fácil não? Basta passar o título do post como parâmentro pelo terminal assim: <code>rake post title="Rake é bem legal"</code>, note que se você deixar vazio ele automaticamente coloca <code>Novo post</code> como valor padrão para o título.<p><a href="/assets/images/posts/2015/08/rake-post-title.png" class="swipebox" rel="gallery" title="Usando Rake tasks para automatizar publicações Jekyll"> <img src="/assets/images/posts/2015/08/rake-post-title.png" alt="rake post title" /> </a><p>Agora que você aprendeu a passar parâmetros para sua rake task, use a criatividade e adicione os parâmetros de <em>tags</em> e <em>categorias</em> para o seu post.<h3 id="usando-mtodos-ruby-para-montar-o-nome-do-arquivo">Usando métodos Ruby para montar o nome do arquivo</h3><p>Tendo o título do post em mãos vamos criar o nome do nosso arquivo, que precisa da data <code>YYY-MM-DDD</code> na frente do slug do post, seguido da extensão <code>.md</code><p>Primeiro montaremos o <code>slug</code> do post usando métodos do próprio Ruby, veja como.<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;Novo post&quot;</span>
  <span class="n">slug</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^\w-]/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">slug</span>
<span class="k">end</span></code></pre></div><p>Mas tem um probleminha, a letra acentuada foi removida, e isso não é bom, teremos que dar um jeito.<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;Novo post&quot;</span>
  <span class="n">slug</span>  <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;ÀÁÂÃÄÅàáâãäåĀāĂăĄąÇçĆćĈĉĊċČčÐðĎďĐđÈÉÊËèéêëĒēĔĕĖėĘęĚěĜĝĞğĠġĢģĤĥĦħÌÍÎÏìíîïĨĩĪīĬĭĮįİıĴĵĶķĸĹĺĻļĽľĿŀŁłÑñŃńŅņŇňŉŊŋÒÓÔÕÖØòóôõöøŌōŎŏŐőŔŕŖŗŘřŚśŜŝŞşŠšſŢţŤťŦŧÙÚÛÜùúûüŨũŪūŬŭŮůŰűŲųŴŵÝýÿŶŷŸŹźŻżŽž&quot;</span><span class="p">,</span> <span class="s2">&quot;AAAAAAaaaaaaAaAaAaCcCcCcCcCcDdDdDdEEEEeeeeEeEeEeEeEeGgGgGgGgHhHhIIIIiiiiIiIiIiIiIiJjKkkLlLlLlLlLlNnNnNnNnnNnOOOOOOooooooOoOoOoRrRrRrSsSsSsSssTtTtTtUUUUuuuuUuUuUuUuUuUuWwYyyYyYZzZzZz&quot;</span><span class="p">)</span>
  <span class="n">slug</span> <span class="o">=</span> <span class="n">slug</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^\w-]/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">slug</span>
<span class="k">end</span></code></pre></div><p><a href="/assets/images/posts/2015/08/rake-e-bem-legal.png" class="swipebox" rel="gallery" title="Usando Rake tasks para automatizar publicações Jekyll"> <img src="/assets/images/posts/2015/08/rake-e-bem-legal.png" alt="rake e bem legal" /> </a><p>É uma solução bem bizarra, mas funciona :)<hr /><p>Agora vamos pegar a data atual e colocar no nome do arquivo.<p>Usando o operador ternário nós pegaremos a data passada como parâmetro pelo terminal, se não existir adicionamos o método <code>now</code> usando a classe <code>Time</code> do Ruby e armazenaremos em uma variável chamada <code>date</code>, assim vale para a hora também, armazenada ma variável <code>time</code>, ficando assim:<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;Novo post&quot;</span>
  <span class="n">slug</span>  <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;ÀÁÂÃÄÅàáâãäåĀāĂăĄąÇçĆćĈĉĊċČčÐðĎďĐđÈÉÊËèéêëĒēĔĕĖėĘęĚěĜĝĞğĠġĢģĤĥĦħÌÍÎÏìíîïĨĩĪīĬĭĮįİıĴĵĶķĸĹĺĻļĽľĿŀŁłÑñŃńŅņŇňŉŊŋÒÓÔÕÖØòóôõöøŌōŎŏŐőŔŕŖŗŘřŚśŜŝŞşŠšſŢţŤťŦŧÙÚÛÜùúûüŨũŪūŬŭŮůŰűŲųŴŵÝýÿŶŷŸŹźŻżŽž&quot;</span><span class="p">,</span> <span class="s2">&quot;AAAAAAaaaaaaAaAaAaCcCcCcCcCcDdDdDdEEEEeeeeEeEeEeEeEeGgGgGgGgHhHhIIIIiiiiIiIiIiIiIiJjKkkLlLlLlLlLlNnNnNnNnnNnOOOOOOooooooOoOoOoRrRrRrSsSsSsSssTtTtTtUUUUuuuuUuUuUuUuUuUuWwYyyYyYZzZzZz&quot;</span><span class="p">)</span>
  <span class="n">slug</span> <span class="o">=</span> <span class="n">slug</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^\w-]/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="n">date</span> <span class="o">=</span> <span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;date&#39;</span><span class="o">]</span> <span class="p">?</span> <span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;date&#39;</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;time&#39;</span><span class="o">]</span> <span class="p">?</span> <span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;time&#39;</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%T&#39;</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">&quot;Error - date format must be YYYY-MM-DD, please check you typed it correctly!&quot;</span>
    <span class="nb">exit</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">end</span>
  <span class="nb">puts</span> <span class="n">date</span>
  <span class="nb">puts</span> <span class="n">time</span>
<span class="k">end</span></code></pre></div><p><a href="/assets/images/posts/2015/08/rake-post-date-time.png" class="swipebox" rel="gallery" title="Usando Rake tasks para automatizar publicações Jekyll"> <img src="/assets/images/posts/2015/08/rake-post-date-time.png" alt="rake - date time" /> </a><p>Usando método <code>File.join()</code> vamos concatenar a data, o slug e a extensão do arquivo armazenando na variável <code>filename</code>:<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;Novo post&quot;</span>
  <span class="n">slug</span>  <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;ÀÁÂÃÄÅàáâãäåĀāĂăĄąÇçĆćĈĉĊċČčÐðĎďĐđÈÉÊËèéêëĒēĔĕĖėĘęĚěĜĝĞğĠġĢģĤĥĦħÌÍÎÏìíîïĨĩĪīĬĭĮįİıĴĵĶķĸĹĺĻļĽľĿŀŁłÑñŃńŅņŇňŉŊŋÒÓÔÕÖØòóôõöøŌōŎŏŐőŔŕŖŗŘřŚśŜŝŞşŠšſŢţŤťŦŧÙÚÛÜùúûüŨũŪūŬŭŮůŰűŲųŴŵÝýÿŶŷŸŹźŻżŽž&quot;</span><span class="p">,</span> <span class="s2">&quot;AAAAAAaaaaaaAaAaAaCcCcCcCcCcDdDdDdEEEEeeeeEeEeEeEeEeGgGgGgGgHhHhIIIIiiiiIiIiIiIiIiJjKkkLlLlLlLlLlNnNnNnNnnNnOOOOOOooooooOoOoOoRrRrRrSsSsSsSssTtTtTtUUUUuuuuUuUuUuUuUuUuWwYyyYyYZzZzZz&quot;</span><span class="p">)</span>
  <span class="n">slug</span> <span class="o">=</span> <span class="n">slug</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^\w-]/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="n">date</span> <span class="o">=</span> <span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;date&#39;</span><span class="o">]</span> <span class="p">?</span> <span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;date&#39;</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;time&#39;</span><span class="o">]</span> <span class="p">?</span> <span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;time&#39;</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%T&#39;</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">&quot;Error - date format must be YYYY-MM-DD, please check you typed it correctly!&quot;</span>
    <span class="nb">exit</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">end</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">POSTS_DIR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">date</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">slug</span><span class="si">}#{</span><span class="no">POST_EXT</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">filename</span>
<span class="k">end</span></code></pre></div><p><a href="/assets/images/posts/2015/08/rake-post-filename.png" class="swipebox" rel="gallery" title="Usando Rake tasks para automatizar publicações Jekyll"> <img src="/assets/images/posts/2015/08/rake-post-filename.png" alt="rake - post filename" /> </a><h3 id="salvando-o-arquivo-do-post">Salvando o arquivo do post</h3><p>Pra finalizar vamos criar o arquivo dentro do diretório <code>_posts/</code> com o nome que acabamos de montar acima.<p>Usando o método de manipulação de arquivos do Ruby nós vamos escrever algumas coisas dentro do nosso arquivo <code>finename</code>, isso já criará o arquivo dentro de <code>_posts/</code>, mais ou menos assim:<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">&quot;Creating new post: </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;---&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;layout: post&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;title: </span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">title</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/-/</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;permalink: </span><span class="si">#{</span><span class="n">slug</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;date: </span><span class="si">#{</span><span class="n">date</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;comments: true&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;description: </span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;keywords: </span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">keywords</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;categories:&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">categories</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;tags:&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">tags</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;---&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div><hr /><h2 id="bonus-">Bonus **</h2><p><a href="https://github.com/nandomoreirame/exemplos/tree/master/rake-tasks-para-automatizar-publicacoes-jekyll">Nesse repositório</a> eu deixei o arquivo <code>Rakefile</code> completo com algumas tasks e algumas funções e úteis, talvez você queira adicionar em seu projeto.<p>Se gostou compartilha e comenta ai.<p>Abraço.</div></div><footer class="post-footer"><div class="container"><section class="author"> <img src="/assets/images/author.jpg" alt="author thumb" class="dot author-thumb"><h4>Fernando Moreira</h4><p>Desenvolvedor Front-end entusiasta de performance, design responsivo e usabilidade, sempre em busca do melhor projeto e de um bom café.</section><aside class="share"><h4>Compartilhe.</h4><a class="share-twitter" href="http://twitter.com/share?text=Usando Rake tasks para automatizar publicações Jekyll&amp;url=http://nandomoreira.me/rake-tasks-para-automatizar-publicacoes-jekyll&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fa fa-twitter-square"></i> </a> <a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://nandomoreira.me/rake-tasks-para-automatizar-publicacoes-jekyll" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"> <i class="fa fa-facebook-square"></i> </a></aside></div></footer><aside id="comments" class="disqus"><div class="container-full"><h3><i class="fa fa-comments"></i> Comentários</h3><hr><div id="disqus_thread"></div><script type="text/javascript"> var disqus_identifier = '/usando-rake-tasks-para-automatizar-publicaes-jekyll'; var disqus_title = 'Usando Rake tasks para automatizar publicações Jekyll'; var disqus_url = 'http://nandomoreira.me'; /*var disqus_developer = 1;*/ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a> </noscript></div></aside></article></main><footer class="footer"><ul class="social"><li> <a href="http://github.com/nandomoreirame" class="icon-github" target="_blank"> <i class="fa fa-github"></i> </a><li> <a href="http://twitter.com/nandomoreirame" class="icon-twitter" target="_blank"> <i class="fa fa-twitter"></i> </a><li> <a href="http://linkedin.com/in/nandomoreirame" class="icon-linkedin" target="_blank"> <i class="fa fa-linkedin"></i> </a><li> <a href="/feed.xml" target="_blank"><i class="fa fa-feed"></i></a></ul><span> Feito com <a href="http://jekyllrb.com" target="_blank">Jekyll</a> • <a href="http://github.com/nandomoreirame/nandomoreirame.github.io" target="_blank">Open source <i class="fa fa-heart"></i></a> </span></footer><a class="scroll-up fa fa-chevron-up bounce" href="#" data-position="0"></a><div id="modalSearch" class="modal-search"><div class="modal-search__overlay"></div><div class="modal-search__content"> <a href="#!" class="modal-search-close" data-modal-close>&times;</a><div class="modal-search-container"> <input type="text" id="modal-search-input" placeholder="#"><ul id="search-results-container"></ul></div></div></div><script src="/assets/main-9ac95fd192ff9afb27abc7e0e70d5f91.js"></script>
